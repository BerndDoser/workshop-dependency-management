= Dependency Management

:imagesdir: images
:icons: font
:date: March 11, 2019
:my_name: Bernd Doser
:my_email: bernd.doser@h-its.org
:my_twitter: BerndDoser
:my_github: BerndDoser
:revealjs_slideNumber: true
:revealjs_center: false
:customcss: custom.css
:source-highlighter: highlightjs

https://h-its.org[HITS gGmbH] +

mailto:{my_email}[{my_name}], {date}


== Introduction

Dependency management is a technique for declaring, resolving and using dependencies required by the project in an automated fashion.

(Source: https://devopedia.org/dependency-manager[Devopedia])

[NOTE.speaker]
--
- Keep your dependencies up to date to reduce technical debts
--

== Package vs Dependency

[%step]
* Package manager: Install applications, libraries and tools on a system
** apt (Linux)
** brew (MacOS)

* Dependency manager: Handle project dependencies across environments
** pip, conda (Python)
** conan ({cpp})
//** npm (NodeJS)
//** gradle (Java)

[NOTE.speaker]
--
- pip was building everything from scratch, until wheels were introduced
- conda has more packages
--

== What is a dependency

* A software unit A (application, module, library) uses functionality of an second software unit B
* A depends on B, A -> B

== Dependency Graph

_Example: Tensorflow_

image::tensorflow-pipdeptree.jpg[width=80%]

[NOTE.speaker]
--
- Multiple depenedencies to same module but with different version requirements 
- Required version as lower bound
--

== Exercise 1
_Install TensorFlow in virtualenv_

== Python packaging

_setup.py_
[source, python]
----
import setuptools

with open("README.md", "r") as fh:
    long_description = fh.read()

setuptools.setup(
    name="example-pkg-your-username",
    version="0.0.1",
    author="Example Author",
    author_email="author@example.com",
    description="A small example package",
    long_description=long_description,
    long_description_content_type="text/markdown",
    url="https://github.com/pypa/sampleproject",
    packages=setuptools.find_packages(),
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ],
)
----

https://packaging.python.org/tutorials/packaging-projects/#creating-setup-py[Docu] / 
https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tools/pip_package/setup.py#L50[Example Tensorflow]

[NOTE.speaker]
--
- Example Tensorflow shows the dependencies in slide before
--


== Docker Development containers

image::docker-devel-env.jpg[width=60%]

[NOTE.speaker]
--
- Modular build 
--


== C++ dependency management with conan.io

== Conan repositories

[%step]
* https://bintray.com/conan/conan-center[conan-center]: Official maintained by the Conan team (178 packages)
* https://bintray.com/bincrafters/public-conan[bincrafters]: Group of OSS developers (370 packages)
* https://bintray.com/braintwister/conan[braintwister]: Personal repository at Bintray for OSS
* Running _conan_server_ for on-site repository


== Installing dependencies

_conanfile.txt_
[source, txt]
----
[requires]
Poco/1.9.0@pocoproject/stable

[generators]
cmake
----

name / version @ user / channel


== Creating package

_conanfile.py_
[source, python]
----
from conans import ConanFile, CMake

class HelloConan(ConanFile):
    name = "Hello"
    version = "0.1"
    license = "<Put the package license here>"
    url = "<Package recipe repository url>"
    description = "<Description of Hello here>"
    settings = "os", "compiler", "build_type", "arch"
    options = {"shared": [True, False]}
    default_options = {"shared": False}
    generators = "cmake"

    def source(self):
        self.run("git clone https://github.com/memsharded/hello.git")
        self.run("cd hello")

    def build(self):
        cmake = CMake(self)
        cmake.configure(source_folder="hello")
        cmake.build()

    def package(self):
        self.copy("*.h", dst="include", src="hello")
        self.copy("*.so", dst="lib", keep_path=False)

    def package_info(self):
        self.cpp_info.libs = ["hello"]
----


